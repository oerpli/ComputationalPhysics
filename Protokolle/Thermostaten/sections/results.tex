% !TeX root = ../Thermostats.tex
% \input{./graphics/Histogramm_relPos_rand_T=20_p=64.tex}
\graphicspath{{../graphics/}}


\subsection{Random initiation}
The following results were obtained by simulations of $10^8$ steps of size $\Delta t = 0.001$ after an equilibration period of $10^7$ steps. 
First of all, we wanted to test whether the thermostating routines disturbed the natural equilibrium of the system. Figure \ref{im:relPos_rand} shows a histogram of the relative positions between adjacent particles on the polymer chain. According to statistical mechanics, the distance between neighbouring chain monomers should follow a normal distribution 

\begin{equation}
f(r_{i,j}) = \frac{\beta^2\hbar^2}{2\pi mq^2}e^{-\frac{\beta^2\hbar^2r^2}{2mq^2}}
\end{equation}  

\begin{figure}[H]
\centering
\includegraphics[width=0.9\textwidth]{./graphics/Histogramm_relPos_rand_T=20_p=64.png}
\caption{Histogram of $r_i - r_j$ for all thermostats}
\label{im:relPos_rand}
\end{figure} 

As can be seen in figure \ref{im:relPos_rand}, the Andersen, Lowe-Andersen and Nosé-Hoover Chain thermostats follow this probability distribution closely. The Bussi-Donadio-Parrinello thermostat, however, leads to a distribution with a much smaller variance and one must assume that the phase-space of the system is not explored correctly with this routine. The values sampled with the Gaussian thermostat follow the distribution closely at the edges, but the minimum of the energy (zero distance between neighbouring monomers) is not the most populated state.  

If we look at the distribution of particle velocities (figure \ref{im:vel_rand}), we see that the kinetic energy and the potential energy are strongly coupled in this system and the errors in the neighbour distance distribution probably arise from the errors in the distribution of velocities. The expected probability distribution is

\begin{equation}
f(v) = \frac{m\beta}{2\pi}e^{-\frac{m\beta v^2}{2}}
\end{equation} 
which is again only achieved by the Andersen, Lowe-Andersen and Nosé-Hoover Chain thermostats. 

\begin{figure}[H]
\centering
\includegraphics[width=0.9\textwidth]{./graphics/Histogramm_velocity_rand_T=20_p=64.png}
\caption{Histogram of particle velocities for all thermostats}
\label{im:vel_rand}
\end{figure}

To take a closer look at the thermostating routines, we also evaluated the distribution of the total kinetic energy. Figure \ref{im:temp_rand} shows the distribution of virtual or instantaneous 'temperature' (i.e. $T^* = 2E_{kin}/q$). The values obtained via the Nosé-Hoover algorithm deviate significantly from the theoretical probability distribution

\begin{equation}
f(T^*) = e^{-\frac{qT^{*}}{2T}}\cdot \Gamma(q/2+1)^{-1}\cdot (mqkT^{*})^{\frac{q-1}{2}} \sqrt{\frac{mqkT^{*}\pi^{\frac{p-1}{2}}}{2}} 
\end{equation}

which is especially intriguing, because the deviation was far less pronounced for the individual velocities (figure \ref{im:vel_rand}). Furthermore, note that, as expected, the Gaussian thermostat keeps the system always at the designated temperature and therefore the resulting ensemble is isokinetic rather than canonical.  

\begin{figure}[H]
\centering
\includegraphics[width=0.9\textwidth]{./graphics/Histogramm_tempCol_rand_T=20_p=64.png}
\caption{Histogram of virtual temperature for all thermostats}
\label{im:temp_rand}
\end{figure}

\begin{figure}[H]
\centering
\includegraphics[width=0.9\textwidth]{./graphics/Histogramm_epot_rand_T=20_p=64.png}
\caption{Histogram of potential energy for all thermostats}
\label{im:epot_rand}
\end{figure}

To detect other possible problems, we also looked at the distribution of monomer positions and the center of mass position (figures \ref{im:absPos_rand} and \ref{im:schwerPos_rand}). Ideally, the center of mass should not move at all, since its velocity was set to zero at the time of initialisation. However, in the Andersen method the center of mass velocity is not conserved due to the stochastic changes in the monomer velocities. The Lowe-Andersen method overcomes this problem by acting on relative velocities rather than absolute velocities, which leaves the total momentum invariant. 
The simulation with the Gaussian thermostat, on the other hand, was apparently subject to a drift in total momentum, which could not be attenuated by the thermostat. However, we believe that the drift is not due to the thermostat, since it only rescales the velocities, which cannot lead to a change of the total momentum if it was initialised to zero. Changes in total momentum can happen due to rounding errors in the velocity Verlet integration scheme. A good thermostating routine should be able to dampen such effects, which is the case for all thermostats except the Andersen and Gaussian methods.       

\begin{figure}[H]
\centering
  \begin{subfigure}[b]{0.5\textwidth}
%\minipage{0.5\textwidth}
  	\includegraphics[width=\linewidth]{./graphics/Histogramm_absPosition_rand_T=20_p=64.png}
  	\caption{Histogram of positions $r_i$}
    \label{im:absPos_rand}
%\endminipage\hfill
  \end{subfigure}\hfill
  \begin{subfigure}[b]{0.5\textwidth}
%\minipage{0.5\textwidth}
    \includegraphics[width=\linewidth]{./graphics/Histogramm_schwerPos_rand_T=20_p=64.png}
    \caption{Histogram of center of mass positions}
    \label{im:schwerPos_rand}
%\endminipage\hfill
  \end{subfigure}
  \caption{Histograms of positions}
\label{fig:pos_rand}
\end{figure}



\begin{figure}[H]
\centering
\includegraphics[width=0.9\textwidth]{./graphics/Histogramm_schwerVel_rand_T=20_p=64.png}
\caption{Histogram of center of mass velocities for all thermostats}
\label{im:schwerVel_rand}
\end{figure} 


\subsection{Biased initialization}
Simulations started with our biased initialization method, which was introduced in section \ref{implementation}, were in general more prone to errors, and helped us to uncover more difficulties with the different thermostats. 

\begin{figure}[H]
\centering
  \begin{subfigure}[b]{0.5\textwidth}
%\minipage{0.5\textwidth}
  	\includegraphics[width=\linewidth]{./graphics/Histogramm_velocity_one_T=20_p=64.png}
  	\caption{Histogram of particle velocities for all thermostats}
    \label{im:vel_one}
%\endminipage\hfill
  \end{subfigure}\hfill
  \begin{subfigure}[b]{0.5\textwidth}
%\minipage{0.5\textwidth}
    \includegraphics[width=\linewidth]{./graphics/Histogramm_schwerVel_one_T=20_p=64.png}
    \caption{Histogram of center of mass velocities for all thermostats}
    \label{im:schwerVel_one} 
%\endminipage\hfill
  \end{subfigure}
  \caption{Histograms of velocities}
\end{figure}

As can be seen from figure \ref{im:vel_one} and \ref{im:schwerVel_one}, the system thermostated using the Berendsen method experienced an acceleration of center of mass velocity, which could not be counteracted by the thermostat. This also lead to an expansion of the whole system and is responsible for the discontinuous histogram in figure \ref{im:relPos_one}.

Furthermore, the center of mass velocity also exhibits a drift when it is thermostated with a Gaussian thermostat. The same considerations apply here as for the random initialization. All other thermostats showed the same behaviour as in the former simulations.     

\begin{figure}[H]
\centering
\includegraphics[width=0.9\textwidth]{./graphics/Histogramm_relPos_one_T=20_p=64.png}
\caption{Histogram of $r_i - r_j$ for all thermostats}
\label{im:relPos_one}
\end{figure} 

\begin{comment}
\begin{figure}[H]
\centering
\includegraphics[width=0.9\textwidth]{./graphics/Histogramm_tempCol_one_T=20_p=64.png}
\caption{Histogram of virtual temperature for all thermostats}
\label{im:temp_one}
\end{figure}

\begin{figure}[H]
\centering
\includegraphics[width=0.9\textwidth]{./graphics/Histogramm_epot_one_T=20_p=64.png}
\caption{Histogram of potential energy for all thermostats}
\label{im:epot_one}
\end{figure}

\begin{figure}[H]
\centering
\includegraphics[width=0.9\textwidth]{./graphics/Histogramm_absPosition_one_T=20_p=64.png}
\caption{Histogram of positions $r_i$ for all thermostats}
\label{im:absPos_one}
\end{figure} 

\begin{figure}[H]
\centering
\includegraphics[width=0.9\textwidth]{./graphics/Histogramm_schwerPos_one_T=20_p=64.png}
\caption{Histogram of center of mass positions for all thermostats}
\label{im:schwerPos_one}
\end{figure} 

\end{comment}


\subsection{Parameters for the Nosé-Hoover Chain}
The Nosé-Hoover thermostat includes a freely choosable parameter $Q$ (or $Q_1$ and $Q_2$ for the Nosé-Hoover Chain), which controls the strength of coupling to the heat bath. As mentioned in section \ref{NHC}, Martyna \textit{et al.} \cite{Martyna1992} suggest using $Q_1 = \frac{qkT}{\omega}$ and $Q_j = \frac{kT}{\omega}$, where $\omega$ is a typical frequency of the system. In our project, we also used these parameters at first with $\omega$ being the frequency of harmonic oscillations resulting from the spring potential.
\begin{equation}
\omega = \sqrt{\frac{k}{m}} = \frac{q}{\beta \hbar}
\end{equation} 
where $k$ is the spring constant. However, as these parameters didn't lead to good results, we varied $Q_2$ over several orders of magnitude while keeping $Q_1 = q\cdot Q_2$. Figure \ref{im:temp_chain} shows the probability distributions of virtual temperature for different values of $Q_2$. We found that a strong coupling - i.e. small $Q_2$ - leads to the best agreement with the theoretical distribution for a canonical ensemble. For comparing the different thermostats (section \ref{results}, the results from the simulation with $Q_1 = 0.001$ and $Q_1 = 0.064$ were used. 

\begin{figure}[H]
\centering
\includegraphics[width=0.9\textwidth]{./graphics/Histogramm_tempCol_one_Chain.png}
\caption{Histogram of virtual temperature of the Nose Hoover Chain for different values of $Q_2$ }
\label{im:temp_chain}
\end{figure}



