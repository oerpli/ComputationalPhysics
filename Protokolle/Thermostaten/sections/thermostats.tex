% !TeX root = ../Thermostats.tex
\TODO[introtext]
We implemented the following thermostats: % vllt jeden thermostat in einem abschnitt beschreiben und hinterher die liste löschen. 
\begin{itemize}
\item Gaussian (velocity rescaling -- fixes temperature $T(t) \equiv T$)
\item Andersen (parameter that controls exchange rate between random particles and heat bath)
\item Lowe-Andersen
\item Berendsen (parameter that controls temperature change rate from actual to preferred temperature)
\item Bussi et al
\item Nose-Hoover
\item Nose-Hoover Chains
\end{itemize}

\subsection{Gaussian}
This thermostat rescales the velocities of the particles to match the average kinetic energy of the particles to the expected value (derived from the Boltzmann distribution at the desired temperature T). This is achieved by calculating the current average $E_t$ of the system (Eq. \eqref{eq:tempdef}) and rescaling the velocities $v$ according to the following formula:
%: temperaturberechnung in unserer simulation irgendwo definieren und hier referenzieren.
\begin{equation*}
v'  = v\cdot \sqrt{\frac{E}{E_t}}
\end{equation*}
The problem of this approach is that it produces a constant temperature which is not entirely in line with the canonical ensemble because sampling from such an ensemble would lead to fluctuations in the temperature and a variance $\sigma_T^2 > 0$.

As this thermostat does not yield any known ensemble we were advised to not use it for serious projects, due to the simplicity of the approach it may still be worth considering for testing purposes or similar ventures.


\subsection{Andersen}
\subsection{Lowe--Andersen}
\subsection{Berendsen}
The temperature is tied to a heat-- bath and a new parameter is introduced that describes the termpature change rate $\tau$:
\begin{equation*}
\frac{dT(t)}{dt} = \frac{T-T(t)}{\tau} %die formel sieht ziemlich blöd aus finde ich grad - hat jmd eine idee für eine bessere konvention bzgl wunsch und aktueller temperatur?
\end{equation*}
A sane (\TODO) choice of this rate allows sampling of a canonical ensemble.
%expand me please

\subsection{Bussi- Donadio- Parrinello}

\subsection{Nose-Hoover}
In contrast to the previously introduced thermostats, which rely on stochastical changes of the velocities of the particles to control temperature, Nosé revised a deterministic thermostat by altering the Hamiltonian of the system ~\cite{Nose2002}. His approach was then further improved by Hoover, who eliminated the need for time scaling ~\cite{Hoover1985}. 
In the original method proposed by Nosé an additional degree of freedom $s$ is introduced, which serves as a scaling factor for the velocities and can be thought of as the external heat bath of the system.
\begin{equation}
v_i = s\cdot \dot{r}
\end{equation}  
Two additional terms associated with $s$ are added to the Hamiltonian of the system, which then reads as follows
\begin{equation}
\mathcal{H}_{Nose} = \sum_i \frac{p_i}{2m_i s^2} + \phi (r) + \frac{p_s^2}{2Q} + (f+1)kT\ln(s) 
\end{equation} 
where $\phi(r)$ denotes the classical potential energy of the system, $f$ the degrees of freedom, $Q$ is a free choice of parameter corresponding to the time scale of the fluctuations in kinetic energy and $p_s = Q\dot{s}$ is the conjugate momentum to $s$. The potential energy term $(f+1)kT\ln{s}$ is chosen such that the right canonical ensemble distribution is obtained in a simulation and the kinetic energy term $\frac{p_s}{2Q}$ is added to get a dynamic equation for the propagation of $s$.   
The equations of motion in the modified system can be obtained via the Hamiltonian equations
\begin{align*}
        & \dot{p} = - \frac{\partial \mathcal{H}}{\partial q} &&  \dot{q} = \frac{\partial \mathcal{H}}{\partial p}
        && \dot{p_s} = - \frac{\partial \mathcal{H}}{\partial s} && \dot{s} = \frac{\partial \mathcal{H}}{\partial p_s} \numberthis \label{eqn}
\end{align*}

and thus read 

\begin{align*}
& \dot{p} = F && \dot{q} = \frac{p}{m s^2} \\
& \dot{p_s} = \sum_i \frac{p_i^2}{2 m s^3} - (f+1)\frac{kT}{s} &&  \dot{s} = \frac{p_s}{Q} \numberthis \label{eqn}
\end{align*}


These coupled equations can be simplified by reducing the time scale by $s$ - i.e. $dt_{old} = s dt_{new} $, which results in


\begin{align*}
& \dot{p} = s F && \dot{q} = \frac{p}{m s} \\
& \dot{p_s} = \sum_i \frac{p_i^2}{2 m s^2} - (f+1)\frac{kT}{s} &&  \dot{s} = \frac{s p_s}{Q} \numberthis \label{eqn}
\end{align*}


Hoover was able to further simplify the approach by eliminating the variable $s$ and rewriting the equations in terms of $q$, $\dot{q}$ and $\ddot{q}$

\begin{equation}
\ddot{q} = \frac{\dot{p}}{m s} - \frac{p}{m s}\dot{s} = \frac{F}{m} - \frac{p_s}{Q}\dot{q} \equiv \frac{F}{m} - \zeta \dot{q}
\end{equation} 

The variable $\zeta = \frac{p_s}{Q}$ is introduced to highlight the analogy between this equation of motion and that of a Newtonian motion with a friction term. It evolves in time as

\begin{equation}
\dot{\zeta} = \left[\sum_i m_i \dot{q}^2_i - (f+1)kT\right]/Q
\end{equation}

Since the damping parameter $\zeta$ is not determined instantaneously, as is the case with e.g. a Gaussian thermostat, but via an equation of motion, the Nosé-Hoover method describes an integral thermostat and therefore leads both smooth as well as time-reversible and deterministic paths in phase space.  

\subsection{Nose-Hoover Chains}
While the Nosé-Hoover thermostat generates the right canonical distributions for large, ergodic systems, it often fails if the system has more than one constant of motion - for example if the total momentum is conserved, as is the case for systems without external forces. This is due to the fact that the limiting distribution of the Nośe-Hoover thermostat has a gaussian dependence not only on the momenta $p_i$ but also on the conjugate momentum $p_s$ of the 'heat bath', but there is no driving force to ensure the correct fluctuations of $p_s$. Martyna and Klein proposed a method to solve this problem, now known as Nosé-Hoover chains \cite{Martyna1992}. The idea is to thermostat $p_s$ as well as its thermostat, etc., forming a chain of thermostats, which can be extended to arbitrary length. For a total of $M$ thermostats, the extended equations of motions take the following form:

\begin{align*}
& \dot{q}_i = \frac{p_i}{m_i} && \dot{p}_i = F_i - p_i \frac{p_{s_1}}{Q_1} \\
& \dot{s}_j = \frac{p_{s_j}}{Q_j} \\
& \dot{p}_{s_1} = \left[ \sum_{i=1}^N \frac{p^2_i}{m_i} - NkT\right] - p_{s_1}\frac{p_{s_2}}{Q_2} \\
& \dot{p}_{s_j} = \left[ \frac{p^2_{s_{j-1}}}{Q_{j-1}} - kT \right] - p_{s_j}\frac{p_{s_{j+1}}}{Q_{j+1}} \\
& \dot{p}_{s_M} = \left[ \frac{p^2_{s_{M-1}}}{Q_{M-1}} - kT\right] \numberthis \label{eqn}
\end{align*}

As with the original Nosé-Hoover method, the 'masses' $Q_j$ of the thermostats determine the strength of the coupling between successive thermostats and have to be chosen carefully to get good results. However, the choice of mass gets less critical the more thermostats are used in the chain. If the system under investigation has a typical frequency $\omega$, a good choice of masses is $Q_1 = \frac{NkT}{\omega}$ and $Q_j = \frac{kT}{\omega}$, which also gives the thermostats an average 'frequency' of $\omega$ \cite{Martyna1992}. 

\subsection{A short note on the implementation of the Nosé-Hoover thermostats}
In the equations of motion of both the Nosé-Hoover thermostat as well as the Nosé-Hoover chains second derivative of the position coordinates depend on the first derivative, which leads to a problem with the standard velocity-verlet integration scheme used with the other thermostats. One possibility to overcome this problem is the use of an iterative scheme - such as i.e. a predictor-corrector method. However, such an approach would lead to the loss of time-reversibility, which is one of the major advantages of the Nośe-Hoover thermostat. For this project we used the explicit time-reversible integrators developed by Martyna \textit{et al.} via the Liouville formalism and a clever use of the Trotter formulas \cite{Martyna1996}.  


  

